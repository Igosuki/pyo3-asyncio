<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `testing` mod in crate `pyo3_asyncio`."><meta name="keywords" content="rust, rustlang, rust-lang, testing"><title>pyo3_asyncio::testing - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings"></script><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../pyo3_asyncio/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><p class="location">Module testing</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></div><p class="location"><a href="../index.html">pyo3_asyncio</a></p><script>window.sidebarCurrent = {name: "testing", ty: "mod", relpath: "../"};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/pyo3_asyncio/testing.rs.html#1-221" title="goto source code">[src]</a></span><span class="in-band">Module <a href="../index.html">pyo3_asyncio</a>::<wbr><a class="mod" href="">testing</a></span></h1><div class="docblock"><p><span class="module-item stab portability" style="display: inline; border-radius: 3px; padding: 2px; font-size: 80%; line-height: 1.2;"><code>testing</code></span> Utilities for writing PyO3 Asyncio tests</p>
<h1 id="pyo3-asyncio-testing-utilities" class="section-header"><a href="#pyo3-asyncio-testing-utilities">PyO3 Asyncio Testing Utilities</a></h1>
<p>This module provides some utilities for parsing test arguments as well as running and filtering
a sequence of tests.</p>
<p>As mentioned <a href="../../pyo3_asyncio/index.html#pythons-event-loop">here</a>, PyO3 Asyncio tests cannot use the default test
harness since it doesn't allow Python to gain control over the main thread. Instead, we have to
provide our own test harness in order to create integration tests.</p>
<h2 id="creating-a-pyo3-asyncio-integration-test" class="section-header"><a href="#creating-a-pyo3-asyncio-integration-test">Creating A PyO3 Asyncio Integration Test</a></h2><h3 id="main-test-file" class="section-header"><a href="#main-test-file">Main Test File</a></h3>
<p>First, we need to create the test's main file. Although these tests are considered integration
tests, we cannot put them in the <code>tests</code> directory since that is a special directory owned by
Cargo. Instead, we put our tests in a <code>pytests</code> directory, although the name <code>pytests</code> is just
a convention.</p>
<p><code>pytests/test_example.rs</code></p>

<div class="example-wrap"><pre class="rust rust-example-rendered">

<span class="kw">fn</span> <span class="ident">main</span>() {

}</pre></div>
<h3 id="test-manifest-entry" class="section-header"><a href="#test-manifest-entry">Test Manifest Entry</a></h3>
<p>Next, we need to add our test file to the Cargo manifest. Add the following section to your
<code>Cargo.toml</code></p>
<pre><code class="language-toml">[[test]]
name = &quot;test_example&quot;
path = &quot;pytests/test_example.rs&quot;
harness = false
</code></pre>
<p>At this point you should be able to run the test via <code>cargo test</code></p>
<h3 id="using-the-pyo3-asyncio-test-harness" class="section-header"><a href="#using-the-pyo3-asyncio-test-harness">Using the PyO3 Asyncio Test Harness</a></h3>
<p>Now that we've got our test registered with <code>cargo test</code>, we can start using the PyO3 Asyncio
test harness.</p>
<p>In your <code>Cargo.toml</code> add the testing feature to <code>pyo3-asyncio</code>:</p>
<pre><code class="language-toml">pyo3-asyncio = { version = &quot;0.13&quot;, features = [&quot;testing&quot;] }
</code></pre>
<p>Now, in your test's main file, call <a href="../../pyo3_asyncio/testing/fn.test_main.html" title="testing::test_main"><code>testing::test_main</code></a>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="ident">pyo3_asyncio</span>::<span class="ident">testing</span>::<span class="ident">test_main</span>(<span class="string">&quot;Example Test Suite&quot;</span>, <span class="macro">vec</span><span class="macro">!</span>[]);
}</pre></div>
<h3 id="adding-tests-to-the-pyo3-asyncio-test-harness" class="section-header"><a href="#adding-tests-to-the-pyo3-asyncio-test-harness">Adding Tests to the PyO3 Asyncio Test Harness</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">pyo3_asyncio</span>::<span class="ident">testing</span>::<span class="ident">Test</span>;

<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="ident">pyo3_asyncio</span>::<span class="ident">testing</span>::<span class="ident">test_main</span>(
        <span class="string">&quot;Example Test Suite&quot;</span>,
        <span class="macro">vec</span><span class="macro">!</span>[
            <span class="ident">Test</span>::<span class="ident">new_async</span>(
                <span class="string">&quot;test_async_sleep&quot;</span>.<span class="ident">into</span>(),
                <span class="ident">async</span> <span class="kw">move</span> {
                     <span class="comment">// async test body</span>
                    <span class="prelude-val">Ok</span>(())
                }
            ),
            <span class="ident">Test</span>::<span class="ident">new_sync</span>(
                <span class="string">&quot;test_blocking_sleep&quot;</span>.<span class="ident">into</span>(),
                <span class="op">|</span><span class="op">|</span> {
                    <span class="comment">// blocking test body</span>
                    <span class="prelude-val">Ok</span>(())
                }
            ),
        ]
    );
}</pre></div>
</div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.Args.html" title="pyo3_asyncio::testing::Args struct">Args</a></td><td class="docblock-short"><p>Args that should be provided to the test program</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.Test.html" title="pyo3_asyncio::testing::Test struct">Test</a></td><td class="docblock-short"><p>Wrapper around a test function or future to be passed to the test harness</p>
</td></tr></table><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<table><tr class="module-item"><td><a class="fn" href="fn.parse_args.html" title="pyo3_asyncio::testing::parse_args fn">parse_args</a></td><td class="docblock-short"><p>Parse the test args from the command line</p>
</td></tr><tr class="module-item"><td><a class="fn" href="fn.test_harness.html" title="pyo3_asyncio::testing::test_harness fn">test_harness</a></td><td class="docblock-short"><p>Run a sequence of tests while applying any necessary filtering from the <code>Args</code></p>
</td></tr><tr class="module-item"><td><a class="fn" href="fn.test_main.html" title="pyo3_asyncio::testing::test_main fn">test_main</a></td><td class="docblock-short"><p>Default main function for the test harness.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "pyo3_asyncio";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>